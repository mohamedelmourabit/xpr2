{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function (d, b) {\n  for (var p in b) {\n    if (b.hasOwnProperty(p)) d[p] = b[p];\n  }\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar http_1 = require(\"@angular/http\");\n\nvar core_1 = require(\"@angular/core\");\n\nvar Observable_1 = require(\"rxjs/Observable\");\n\nrequire(\"rxjs/add/observable/fromPromise\");\n\nrequire(\"rxjs/add/observable/defer\");\n\nrequire(\"rxjs/add/operator/mergeMap\");\n\nvar AuthConfigConsts = function () {\n  function AuthConfigConsts() {}\n\n  return AuthConfigConsts;\n}();\n\nAuthConfigConsts.DEFAULT_TOKEN_NAME = 'token';\nAuthConfigConsts.DEFAULT_HEADER_NAME = 'Authorization';\nAuthConfigConsts.HEADER_PREFIX_BEARER = 'Bearer ';\nexports.AuthConfigConsts = AuthConfigConsts;\nvar AuthConfigDefaults = {\n  headerName: AuthConfigConsts.DEFAULT_HEADER_NAME,\n  headerPrefix: null,\n  tokenName: AuthConfigConsts.DEFAULT_TOKEN_NAME,\n  tokenGetter: function tokenGetter() {\n    return localStorage.getItem(AuthConfigDefaults.tokenName);\n  },\n  noJwtError: false,\n  noClientCheck: false,\n  globalHeaders: [],\n  noTokenScheme: false\n};\n/**\n * Sets up the authentication configuration.\n */\n\nvar AuthConfig = function () {\n  function AuthConfig(config) {\n    config = config || {};\n    this._config = objectAssign({}, AuthConfigDefaults, config);\n\n    if (this._config.headerPrefix) {\n      this._config.headerPrefix += ' ';\n    } else if (this._config.noTokenScheme) {\n      this._config.headerPrefix = '';\n    } else {\n      this._config.headerPrefix = AuthConfigConsts.HEADER_PREFIX_BEARER;\n    }\n\n    if (config.tokenName && !config.tokenGetter) {\n      this._config.tokenGetter = function () {\n        return localStorage.getItem(config.tokenName);\n      };\n    }\n  }\n\n  AuthConfig.prototype.getConfig = function () {\n    return this._config;\n  };\n\n  return AuthConfig;\n}();\n\nexports.AuthConfig = AuthConfig;\n\nvar AuthHttpError = function (_super) {\n  __extends(AuthHttpError, _super);\n\n  function AuthHttpError() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  return AuthHttpError;\n}(Error);\n\nexports.AuthHttpError = AuthHttpError;\n/**\n * Allows for explicit authenticated HTTP requests.\n */\n\nvar AuthHttp = function () {\n  function AuthHttp(options, http, defOpts) {\n    var _this = this;\n\n    this.http = http;\n    this.defOpts = defOpts;\n    this.config = options.getConfig();\n    this.tokenStream = new Observable_1.Observable(function (obs) {\n      obs.next(_this.config.tokenGetter());\n    });\n  }\n\n  AuthHttp.prototype.mergeOptions = function (providedOpts, defaultOpts) {\n    var newOptions = defaultOpts || new http_1.RequestOptions();\n\n    if (this.config.globalHeaders) {\n      this.setGlobalHeaders(this.config.globalHeaders, providedOpts);\n    }\n\n    newOptions = newOptions.merge(new http_1.RequestOptions(providedOpts));\n    return newOptions;\n  };\n\n  AuthHttp.prototype.requestHelper = function (requestArgs, additionalOptions) {\n    var options = new http_1.RequestOptions(requestArgs);\n\n    if (additionalOptions) {\n      options = options.merge(additionalOptions);\n    }\n\n    return this.request(new http_1.Request(this.mergeOptions(options, this.defOpts)));\n  };\n\n  AuthHttp.prototype.requestWithToken = function (req, token) {\n    if (!this.config.noClientCheck && !tokenNotExpired(undefined, token)) {\n      if (!this.config.noJwtError) {\n        return new Observable_1.Observable(function (obs) {\n          obs.error(new AuthHttpError('No JWT present or has expired'));\n        });\n      }\n    } else {\n      req.headers.set(this.config.headerName, this.config.headerPrefix + token);\n    }\n\n    return this.http.request(req);\n  };\n\n  AuthHttp.prototype.setGlobalHeaders = function (headers, request) {\n    if (!request.headers) {\n      request.headers = new http_1.Headers();\n    }\n\n    headers.forEach(function (header) {\n      var key = Object.keys(header)[0];\n      var headerValue = header[key];\n      request.headers.set(key, headerValue);\n    });\n  };\n\n  AuthHttp.prototype.request = function (url, options) {\n    var _this = this;\n\n    if (typeof url === 'string') {\n      return this.get(url, options); // Recursion: transform url from String to Request\n    } // else if ( ! url instanceof Request ) {\n    //   throw new Error('First argument must be a url string or Request instance.');\n    // }\n    // from this point url is always an instance of Request;\n\n\n    var req = url; // Create a cold observable and load the token just in time\n\n    return Observable_1.Observable.defer(function () {\n      var token = _this.config.tokenGetter();\n\n      if (token instanceof Promise) {\n        return Observable_1.Observable.fromPromise(token).mergeMap(function (jwtToken) {\n          return _this.requestWithToken(req, jwtToken);\n        });\n      } else {\n        return _this.requestWithToken(req, token);\n      }\n    });\n  };\n\n  AuthHttp.prototype.get = function (url, options) {\n    return this.requestHelper({\n      body: '',\n      method: http_1.RequestMethod.Get,\n      url: url\n    }, options);\n  };\n\n  AuthHttp.prototype.post = function (url, body, options) {\n    return this.requestHelper({\n      body: body,\n      method: http_1.RequestMethod.Post,\n      url: url\n    }, options);\n  };\n\n  AuthHttp.prototype.put = function (url, body, options) {\n    return this.requestHelper({\n      body: body,\n      method: http_1.RequestMethod.Put,\n      url: url\n    }, options);\n  };\n\n  AuthHttp.prototype.delete = function (url, options) {\n    return this.requestHelper({\n      body: '',\n      method: http_1.RequestMethod.Delete,\n      url: url\n    }, options);\n  };\n\n  AuthHttp.prototype.patch = function (url, body, options) {\n    return this.requestHelper({\n      body: body,\n      method: http_1.RequestMethod.Patch,\n      url: url\n    }, options);\n  };\n\n  AuthHttp.prototype.head = function (url, options) {\n    return this.requestHelper({\n      body: '',\n      method: http_1.RequestMethod.Head,\n      url: url\n    }, options);\n  };\n\n  AuthHttp.prototype.options = function (url, options) {\n    return this.requestHelper({\n      body: '',\n      method: http_1.RequestMethod.Options,\n      url: url\n    }, options);\n  };\n\n  return AuthHttp;\n}();\n\nAuthHttp = __decorate([core_1.Injectable(), __metadata(\"design:paramtypes\", [AuthConfig, http_1.Http, http_1.RequestOptions])], AuthHttp);\nexports.AuthHttp = AuthHttp;\n/**\n * Helper class to decode and find JWT expiration.\n */\n\nvar JwtHelper = function () {\n  function JwtHelper() {}\n\n  JwtHelper.prototype.urlBase64Decode = function (str) {\n    var output = str.replace(/-/g, '+').replace(/_/g, '/');\n\n    switch (output.length % 4) {\n      case 0:\n        {\n          break;\n        }\n\n      case 2:\n        {\n          output += '==';\n          break;\n        }\n\n      case 3:\n        {\n          output += '=';\n          break;\n        }\n\n      default:\n        {\n          throw 'Illegal base64url string!';\n        }\n    }\n\n    return this.b64DecodeUnicode(output);\n  }; // credits for decoder goes to https://github.com/atk\n\n\n  JwtHelper.prototype.b64decode = function (str) {\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    var output = '';\n    str = String(str).replace(/=+$/, '');\n\n    if (str.length % 4 == 1) {\n      throw new Error(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n    }\n\n    for ( // initialize result and counters\n    var bc = 0, bs = void 0, buffer = void 0, idx = 0; // get next character\n    buffer = str.charAt(idx++); // character found in table? initialize bit storage and add its ascii value;\n    ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer, // and if not first of each 4 characters,\n    // convert the first 8 bits to one ascii character\n    bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n    }\n\n    return output;\n  }; // https://developer.mozilla.org/en/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem\n\n\n  JwtHelper.prototype.b64DecodeUnicode = function (str) {\n    return decodeURIComponent(Array.prototype.map.call(this.b64decode(str), function (c) {\n      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(''));\n  };\n\n  JwtHelper.prototype.decodeToken = function (token) {\n    var parts = token.split('.');\n\n    if (parts.length !== 3) {\n      throw new Error('JWT must have 3 parts');\n    }\n\n    var decoded = this.urlBase64Decode(parts[1]);\n\n    if (!decoded) {\n      throw new Error('Cannot decode the token');\n    }\n\n    return JSON.parse(decoded);\n  };\n\n  JwtHelper.prototype.getTokenExpirationDate = function (token) {\n    var decoded;\n    decoded = this.decodeToken(token);\n\n    if (!decoded.hasOwnProperty('exp')) {\n      return null;\n    }\n\n    var date = new Date(0); // The 0 here is the key, which sets the date to the epoch\n\n    date.setUTCSeconds(decoded.exp);\n    return date;\n  };\n\n  JwtHelper.prototype.isTokenExpired = function (token, offsetSeconds) {\n    var date = this.getTokenExpirationDate(token);\n    offsetSeconds = offsetSeconds || 0;\n\n    if (date == null) {\n      return false;\n    } // Token expired?\n\n\n    return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000);\n  };\n\n  return JwtHelper;\n}();\n\nexports.JwtHelper = JwtHelper;\n/**\n * Checks for presence of token and that token hasn't expired.\n * For use with the @CanActivate router decorator and NgIf\n */\n\nfunction tokenNotExpired(tokenName, jwt) {\n  if (tokenName === void 0) {\n    tokenName = AuthConfigConsts.DEFAULT_TOKEN_NAME;\n  }\n\n  var token = jwt || localStorage.getItem(tokenName);\n  var jwtHelper = new JwtHelper();\n  return token != null && !jwtHelper.isTokenExpired(token);\n}\n\nexports.tokenNotExpired = tokenNotExpired;\nexports.AUTH_PROVIDERS = [{\n  provide: AuthHttp,\n  deps: [http_1.Http, http_1.RequestOptions],\n  useFactory: function useFactory(http, options) {\n    return new AuthHttp(new AuthConfig(), http, options);\n  }\n}];\n\nfunction provideAuth(config) {\n  return [{\n    provide: AuthHttp,\n    deps: [http_1.Http, http_1.RequestOptions],\n    useFactory: function useFactory(http, options) {\n      return new AuthHttp(new AuthConfig(config), http, options);\n    }\n  }];\n}\n\nexports.provideAuth = provideAuth;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n  if (val === null || val === undefined) {\n    throw new TypeError('Object.assign cannot be called with null or undefined');\n  }\n\n  return Object(val);\n}\n\nfunction objectAssign(target) {\n  var source = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    source[_i - 1] = arguments[_i];\n  }\n\n  var from;\n  var to = toObject(target);\n  var symbols;\n\n  for (var s = 1; s < arguments.length; s++) {\n    from = Object(arguments[s]);\n\n    for (var key in from) {\n      if (hasOwnProperty.call(from, key)) {\n        to[key] = from[key];\n      }\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      symbols = Object.getOwnPropertySymbols(from);\n\n      for (var i = 0; i < symbols.length; i++) {\n        if (propIsEnumerable.call(from, symbols[i])) {\n          to[symbols[i]] = from[symbols[i]];\n        }\n      }\n    }\n  }\n\n  return to;\n}\n/**\n * Module for angular2-jwt\n * @experimental\n */\n\n\nvar AuthModule = AuthModule_1 = function () {\n  function AuthModule(parentModule) {\n    if (parentModule) {\n      throw new Error('AuthModule is already loaded. Import it in the AppModule only');\n    }\n  }\n\n  AuthModule.forRoot = function (config) {\n    return {\n      ngModule: AuthModule_1,\n      providers: [{\n        provide: AuthConfig,\n        useValue: config\n      }]\n    };\n  };\n\n  return AuthModule;\n}();\n\nAuthModule = AuthModule_1 = __decorate([core_1.NgModule({\n  imports: [http_1.HttpModule],\n  providers: [AuthHttp, JwtHelper]\n}), __param(0, core_1.Optional()), __param(0, core_1.SkipSelf()), __metadata(\"design:paramtypes\", [AuthModule])], AuthModule);\nexports.AuthModule = AuthModule;\nvar AuthModule_1; //# sourceMappingURL=angular2-jwt.js.map","map":{"version":3,"sources":["/Users/mohammedelmourabit/xrp/xpr/node_modules/angular2-jwt/angular2-jwt.js"],"names":["__extends","d","b","p","hasOwnProperty","__","constructor","prototype","Object","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","__param","paramIndex","decorator","http_1","require","core_1","Observable_1","AuthConfigConsts","DEFAULT_TOKEN_NAME","DEFAULT_HEADER_NAME","HEADER_PREFIX_BEARER","exports","AuthConfigDefaults","headerName","headerPrefix","tokenName","tokenGetter","localStorage","getItem","noJwtError","noClientCheck","globalHeaders","noTokenScheme","AuthConfig","config","_config","objectAssign","getConfig","AuthHttpError","_super","apply","Error","AuthHttp","options","http","defOpts","_this","tokenStream","Observable","obs","next","mergeOptions","providedOpts","defaultOpts","newOptions","RequestOptions","setGlobalHeaders","merge","requestHelper","requestArgs","additionalOptions","request","Request","requestWithToken","req","token","tokenNotExpired","undefined","error","headers","set","Headers","forEach","header","keys","headerValue","url","get","defer","Promise","fromPromise","mergeMap","jwtToken","body","method","RequestMethod","Get","post","Post","put","Put","delete","Delete","patch","Patch","head","Head","Options","Injectable","Http","JwtHelper","urlBase64Decode","str","output","replace","b64DecodeUnicode","b64decode","chars","String","bc","bs","buffer","idx","charAt","fromCharCode","indexOf","decodeURIComponent","Array","map","call","charCodeAt","toString","slice","join","decodeToken","parts","split","decoded","JSON","parse","getTokenExpirationDate","date","Date","setUTCSeconds","exp","isTokenExpired","offsetSeconds","valueOf","jwt","jwtHelper","AUTH_PROVIDERS","provide","deps","useFactory","provideAuth","propIsEnumerable","propertyIsEnumerable","toObject","val","TypeError","source","_i","from","to","symbols","s","getOwnPropertySymbols","AuthModule","AuthModule_1","parentModule","forRoot","ngModule","providers","useValue","NgModule","imports","HttpModule","Optional","SkipSelf"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar http_1 = require(\"@angular/http\");\nvar core_1 = require(\"@angular/core\");\nvar Observable_1 = require(\"rxjs/Observable\");\nrequire(\"rxjs/add/observable/fromPromise\");\nrequire(\"rxjs/add/observable/defer\");\nrequire(\"rxjs/add/operator/mergeMap\");\nvar AuthConfigConsts = (function () {\n    function AuthConfigConsts() {\n    }\n    return AuthConfigConsts;\n}());\nAuthConfigConsts.DEFAULT_TOKEN_NAME = 'token';\nAuthConfigConsts.DEFAULT_HEADER_NAME = 'Authorization';\nAuthConfigConsts.HEADER_PREFIX_BEARER = 'Bearer ';\nexports.AuthConfigConsts = AuthConfigConsts;\nvar AuthConfigDefaults = {\n    headerName: AuthConfigConsts.DEFAULT_HEADER_NAME,\n    headerPrefix: null,\n    tokenName: AuthConfigConsts.DEFAULT_TOKEN_NAME,\n    tokenGetter: function () { return localStorage.getItem(AuthConfigDefaults.tokenName); },\n    noJwtError: false,\n    noClientCheck: false,\n    globalHeaders: [],\n    noTokenScheme: false\n};\n/**\n * Sets up the authentication configuration.\n */\nvar AuthConfig = (function () {\n    function AuthConfig(config) {\n        config = config || {};\n        this._config = objectAssign({}, AuthConfigDefaults, config);\n        if (this._config.headerPrefix) {\n            this._config.headerPrefix += ' ';\n        }\n        else if (this._config.noTokenScheme) {\n            this._config.headerPrefix = '';\n        }\n        else {\n            this._config.headerPrefix = AuthConfigConsts.HEADER_PREFIX_BEARER;\n        }\n        if (config.tokenName && !config.tokenGetter) {\n            this._config.tokenGetter = function () { return localStorage.getItem(config.tokenName); };\n        }\n    }\n    AuthConfig.prototype.getConfig = function () {\n        return this._config;\n    };\n    return AuthConfig;\n}());\nexports.AuthConfig = AuthConfig;\nvar AuthHttpError = (function (_super) {\n    __extends(AuthHttpError, _super);\n    function AuthHttpError() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return AuthHttpError;\n}(Error));\nexports.AuthHttpError = AuthHttpError;\n/**\n * Allows for explicit authenticated HTTP requests.\n */\nvar AuthHttp = (function () {\n    function AuthHttp(options, http, defOpts) {\n        var _this = this;\n        this.http = http;\n        this.defOpts = defOpts;\n        this.config = options.getConfig();\n        this.tokenStream = new Observable_1.Observable(function (obs) {\n            obs.next(_this.config.tokenGetter());\n        });\n    }\n    AuthHttp.prototype.mergeOptions = function (providedOpts, defaultOpts) {\n        var newOptions = defaultOpts || new http_1.RequestOptions();\n        if (this.config.globalHeaders) {\n            this.setGlobalHeaders(this.config.globalHeaders, providedOpts);\n        }\n        newOptions = newOptions.merge(new http_1.RequestOptions(providedOpts));\n        return newOptions;\n    };\n    AuthHttp.prototype.requestHelper = function (requestArgs, additionalOptions) {\n        var options = new http_1.RequestOptions(requestArgs);\n        if (additionalOptions) {\n            options = options.merge(additionalOptions);\n        }\n        return this.request(new http_1.Request(this.mergeOptions(options, this.defOpts)));\n    };\n    AuthHttp.prototype.requestWithToken = function (req, token) {\n        if (!this.config.noClientCheck && !tokenNotExpired(undefined, token)) {\n            if (!this.config.noJwtError) {\n                return new Observable_1.Observable(function (obs) {\n                    obs.error(new AuthHttpError('No JWT present or has expired'));\n                });\n            }\n        }\n        else {\n            req.headers.set(this.config.headerName, this.config.headerPrefix + token);\n        }\n        return this.http.request(req);\n    };\n    AuthHttp.prototype.setGlobalHeaders = function (headers, request) {\n        if (!request.headers) {\n            request.headers = new http_1.Headers();\n        }\n        headers.forEach(function (header) {\n            var key = Object.keys(header)[0];\n            var headerValue = header[key];\n            request.headers.set(key, headerValue);\n        });\n    };\n    AuthHttp.prototype.request = function (url, options) {\n        var _this = this;\n        if (typeof url === 'string') {\n            return this.get(url, options); // Recursion: transform url from String to Request\n        }\n        // else if ( ! url instanceof Request ) {\n        //   throw new Error('First argument must be a url string or Request instance.');\n        // }\n        // from this point url is always an instance of Request;\n        var req = url;\n        // Create a cold observable and load the token just in time\n        return Observable_1.Observable.defer(function () {\n            var token = _this.config.tokenGetter();\n            if (token instanceof Promise) {\n                return Observable_1.Observable.fromPromise(token).mergeMap(function (jwtToken) { return _this.requestWithToken(req, jwtToken); });\n            }\n            else {\n                return _this.requestWithToken(req, token);\n            }\n        });\n    };\n    AuthHttp.prototype.get = function (url, options) {\n        return this.requestHelper({ body: '', method: http_1.RequestMethod.Get, url: url }, options);\n    };\n    AuthHttp.prototype.post = function (url, body, options) {\n        return this.requestHelper({ body: body, method: http_1.RequestMethod.Post, url: url }, options);\n    };\n    AuthHttp.prototype.put = function (url, body, options) {\n        return this.requestHelper({ body: body, method: http_1.RequestMethod.Put, url: url }, options);\n    };\n    AuthHttp.prototype.delete = function (url, options) {\n        return this.requestHelper({ body: '', method: http_1.RequestMethod.Delete, url: url }, options);\n    };\n    AuthHttp.prototype.patch = function (url, body, options) {\n        return this.requestHelper({ body: body, method: http_1.RequestMethod.Patch, url: url }, options);\n    };\n    AuthHttp.prototype.head = function (url, options) {\n        return this.requestHelper({ body: '', method: http_1.RequestMethod.Head, url: url }, options);\n    };\n    AuthHttp.prototype.options = function (url, options) {\n        return this.requestHelper({ body: '', method: http_1.RequestMethod.Options, url: url }, options);\n    };\n    return AuthHttp;\n}());\nAuthHttp = __decorate([\n    core_1.Injectable(),\n    __metadata(\"design:paramtypes\", [AuthConfig, http_1.Http, http_1.RequestOptions])\n], AuthHttp);\nexports.AuthHttp = AuthHttp;\n/**\n * Helper class to decode and find JWT expiration.\n */\nvar JwtHelper = (function () {\n    function JwtHelper() {\n    }\n    JwtHelper.prototype.urlBase64Decode = function (str) {\n        var output = str.replace(/-/g, '+').replace(/_/g, '/');\n        switch (output.length % 4) {\n            case 0: {\n                break;\n            }\n            case 2: {\n                output += '==';\n                break;\n            }\n            case 3: {\n                output += '=';\n                break;\n            }\n            default: {\n                throw 'Illegal base64url string!';\n            }\n        }\n        return this.b64DecodeUnicode(output);\n    };\n    // credits for decoder goes to https://github.com/atk\n    JwtHelper.prototype.b64decode = function (str) {\n        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n        var output = '';\n        str = String(str).replace(/=+$/, '');\n        if (str.length % 4 == 1) {\n            throw new Error(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n        }\n        for (\n        // initialize result and counters\n        var bc = 0, bs = void 0, buffer = void 0, idx = 0; \n        // get next character\n        buffer = str.charAt(idx++); \n        // character found in table? initialize bit storage and add its ascii value;\n        ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n            // and if not first of each 4 characters,\n            // convert the first 8 bits to one ascii character\n            bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0) {\n            // try to find character in table (0-63, not found => -1)\n            buffer = chars.indexOf(buffer);\n        }\n        return output;\n    };\n    // https://developer.mozilla.org/en/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem\n    JwtHelper.prototype.b64DecodeUnicode = function (str) {\n        return decodeURIComponent(Array.prototype.map.call(this.b64decode(str), function (c) {\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(''));\n    };\n    JwtHelper.prototype.decodeToken = function (token) {\n        var parts = token.split('.');\n        if (parts.length !== 3) {\n            throw new Error('JWT must have 3 parts');\n        }\n        var decoded = this.urlBase64Decode(parts[1]);\n        if (!decoded) {\n            throw new Error('Cannot decode the token');\n        }\n        return JSON.parse(decoded);\n    };\n    JwtHelper.prototype.getTokenExpirationDate = function (token) {\n        var decoded;\n        decoded = this.decodeToken(token);\n        if (!decoded.hasOwnProperty('exp')) {\n            return null;\n        }\n        var date = new Date(0); // The 0 here is the key, which sets the date to the epoch\n        date.setUTCSeconds(decoded.exp);\n        return date;\n    };\n    JwtHelper.prototype.isTokenExpired = function (token, offsetSeconds) {\n        var date = this.getTokenExpirationDate(token);\n        offsetSeconds = offsetSeconds || 0;\n        if (date == null) {\n            return false;\n        }\n        // Token expired?\n        return !(date.valueOf() > (new Date().valueOf() + (offsetSeconds * 1000)));\n    };\n    return JwtHelper;\n}());\nexports.JwtHelper = JwtHelper;\n/**\n * Checks for presence of token and that token hasn't expired.\n * For use with the @CanActivate router decorator and NgIf\n */\nfunction tokenNotExpired(tokenName, jwt) {\n    if (tokenName === void 0) { tokenName = AuthConfigConsts.DEFAULT_TOKEN_NAME; }\n    var token = jwt || localStorage.getItem(tokenName);\n    var jwtHelper = new JwtHelper();\n    return token != null && !jwtHelper.isTokenExpired(token);\n}\nexports.tokenNotExpired = tokenNotExpired;\nexports.AUTH_PROVIDERS = [\n    {\n        provide: AuthHttp,\n        deps: [http_1.Http, http_1.RequestOptions],\n        useFactory: function (http, options) {\n            return new AuthHttp(new AuthConfig(), http, options);\n        }\n    }\n];\nfunction provideAuth(config) {\n    return [\n        {\n            provide: AuthHttp,\n            deps: [http_1.Http, http_1.RequestOptions],\n            useFactory: function (http, options) {\n                return new AuthHttp(new AuthConfig(config), http, options);\n            }\n        }\n    ];\n}\nexports.provideAuth = provideAuth;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\nfunction toObject(val) {\n    if (val === null || val === undefined) {\n        throw new TypeError('Object.assign cannot be called with null or undefined');\n    }\n    return Object(val);\n}\nfunction objectAssign(target) {\n    var source = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        source[_i - 1] = arguments[_i];\n    }\n    var from;\n    var to = toObject(target);\n    var symbols;\n    for (var s = 1; s < arguments.length; s++) {\n        from = Object(arguments[s]);\n        for (var key in from) {\n            if (hasOwnProperty.call(from, key)) {\n                to[key] = from[key];\n            }\n        }\n        if (Object.getOwnPropertySymbols) {\n            symbols = Object.getOwnPropertySymbols(from);\n            for (var i = 0; i < symbols.length; i++) {\n                if (propIsEnumerable.call(from, symbols[i])) {\n                    to[symbols[i]] = from[symbols[i]];\n                }\n            }\n        }\n    }\n    return to;\n}\n/**\n * Module for angular2-jwt\n * @experimental\n */\nvar AuthModule = AuthModule_1 = (function () {\n    function AuthModule(parentModule) {\n        if (parentModule) {\n            throw new Error('AuthModule is already loaded. Import it in the AppModule only');\n        }\n    }\n    AuthModule.forRoot = function (config) {\n        return {\n            ngModule: AuthModule_1,\n            providers: [\n                { provide: AuthConfig, useValue: config }\n            ]\n        };\n    };\n    return AuthModule;\n}());\nAuthModule = AuthModule_1 = __decorate([\n    core_1.NgModule({\n        imports: [http_1.HttpModule],\n        providers: [AuthHttp, JwtHelper]\n    }),\n    __param(0, core_1.Optional()), __param(0, core_1.SkipSelf()),\n    __metadata(\"design:paramtypes\", [AuthModule])\n], AuthModule);\nexports.AuthModule = AuthModule;\nvar AuthModule_1;\n//# sourceMappingURL=angular2-jwt.js.map"]},"metadata":{},"sourceType":"script"}